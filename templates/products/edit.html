{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}Edit Product - ShopCloud{% endblock %}

{% block dashboard_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<style>
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    background: #FFFFFF;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 1px 6px rgba(15, 23, 42, 0.06);
}

.page-header h1 {
    margin: 0;
    font-size: 1.8rem;
    color: #1f2937;
    font-weight: 700;
}

.form-container {
    max-width: 900px;
    background: #FFFFFF;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 1px 6px rgba(15, 23, 42, 0.06);
}

.form-label {
    font-weight: 600;
    color: #1A202C;
    margin-bottom: 8px;
    display: block;
}

.form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #E0E3E7;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s;
}

.form-control:focus {
    outline: none;
    border-color: #4A6CF7;
    box-shadow: 0 0 0 0.15rem rgba(74, 108, 247, 0.25);
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 2px solid #e5e7eb;
}

.btn {
    /* global buttons; size tweak only */
    padding: 10px 24px;
}

.current-image {
    margin-top: 15px;
}

.preview-image {
    max-width: 120px;
    max-height: 120px;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid #e5e7eb;
    margin-top: 10px;
}

.row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.col-md-6 {
    flex: 1;
}

.col-md-4 {
    flex: 0 0 calc(33.333% - 14px);
}

@media (max-width: 768px) {
    .row {
        flex-direction: column;
    }
    
    .col-md-4,
    .col-md-6 {
        flex: 1;
    }
}
</style>
{% endblock %}

{% block dashboard_content %}

        <div class="page-header">
            <h1>Edit Product</h1>
            <a href="{% url 'products:list' %}" class="btn btn-secondary">‚Üê Back to Products</a>
        </div>

        <div class="form-container">
            <div class="card">
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}

                    <form method="post" enctype="multipart/form-data" action="{% url 'products:edit' product.id %}">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Product Name *</label>
                                <input type="text" class="form-control" id="name" name="name" value="{{ product.name }}" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-control" id="category" name="category">
                                    <option value="">Select Category</option>
                                    {% for category in categories %}
                                        <option value="{{ category.id }}" {% if product.category.id == category.id %}selected{% endif %}>
                                            {{ category.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="unit" class="form-label">Unit *</label>
                                <select class="form-control" id="unit" name="unit" required>
                                    <option value="piece" {% if product.unit == 'piece' %}selected{% endif %}>Piece</option>
                                    <option value="kg" {% if product.unit == 'kg' %}selected{% endif %}>Kilogram</option>
                                    <option value="liter" {% if product.unit == 'liter' %}selected{% endif %}>Liter</option>
                                    <option value="meter" {% if product.unit == 'meter' %}selected{% endif %}>Meter</option>
                                    <option value="box" {% if product.unit == 'box' %}selected{% endif %}>Box</option>
                                    <option value="dozen" {% if product.unit == 'dozen' %}selected{% endif %}>Dozen</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="cost_price" class="form-label">Cost Price (Rs.) *</label>
                                <input type="number" step="0.01" class="form-control" id="cost_price" name="cost_price" value="{{ product.cost_price }}" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="sale_price" class="form-label">Sale Price (Rs.) *</label>
                                <input type="number" step="0.01" class="form-control" id="sale_price" name="sale_price" value="{{ product.sale_price }}" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="stock" class="form-label">Stock Quantity *</label>
                                <input type="number" class="form-control" id="stock" name="stock" value="{{ product.stock }}" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="min_stock_alert" class="form-label">Min Stock Alert</label>
                                <input type="number" class="form-control" id="min_stock_alert" name="min_stock_alert" value="{{ product.min_stock_alert }}">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="barcode" class="form-label">Barcode</label>
                                <input type="text" class="form-control" id="barcode" name="barcode" value="{{ product.barcode }}">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="image" class="form-label">Product Image</label>
                                <input type="file" class="form-control" id="image" name="image" accept="image/*">
                                {% if product.image %}
                                    <div class="current-image">
                                        <small>Current image:</small><br>
                                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="preview-image">
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3">{{ product.description }}</textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">Update Product</button>
                            <a href="{% url 'products:list' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>

<style>
.form-container {
    max-width: 800px;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.row {
    display: flex;
    gap: 20px;
}

.col-md-6 {
    flex: 1;
}

.col-md-4 {
    flex: 0 0 33.333%;
}

.current-image {
    margin-top: 10px;
}

.preview-image {
    max-width: 100px;
    max-height: 100px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid #ddd;
}
</style>

<script>
// Form validation
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const submitBtn = document.querySelector('button[type="submit"]');
    
    if (form && submitBtn) {
        form.addEventListener('submit', function(e) {
            const name = document.getElementById('name').value.trim();
            const salePrice = document.getElementById('sale_price').value;
            
            if (!name) {
                alert('Product name is required!');
                e.preventDefault();
                return false;
            }
            
            if (!salePrice || parseFloat(salePrice) <= 0) {
                alert('Sale price must be greater than zero!');
                e.preventDefault();
                return false;
            }
            
            // Disable submit button to prevent double submission
            submitBtn.disabled = true;
            submitBtn.textContent = 'Updating...';
        });
    }
});
</script>
{% endblock %}